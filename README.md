# SMS to Telegram Gateway
A lightweight script to send received messages (SMS) to a Telegram Group.

## Devices
- Raspberry Pi
- Huawei USB Modem

## Setup
### 1. Setup the Raspberry Pi
### 2. Connect to it via SSH
### 3. Setup the Modem
```bash
nano /etc/udev/rules.d/41-usb_modeswitch.rules
```

The file must contain the following line:
```bash
ACTION=="add", SUBSYSTEM=="usb", ATTRS{idVendor}=="12d1", ATTRS{idProduct}=="1446", RUN+="/usr/sbin/usb_modeswitch -v 12d1 -p 1446 -M '55534243123456780000000000000011062000000100000000000000000000'"
```

If you have a another modem as the E1552, get the id of the pruduct via `lsusb`.
The output shows something like this:
```
                   idVendor:idProduct
                        V    V
Bus 001 Device 005: ID 12d1:1446 Huawei Technologies Co., Ltd. E180v 
Bus 001 Device 003: ID 0424:ec00 Standard Microsystems Corp. SMSC9512/9514 Fast Ethernet Adapter
Bus 001 Device 002: ID 0424:9512 Standard Microsystems Corp. LAN9500 Ethernet 10/100 Adapter / SMSC9512/9514 Hub
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
```
### 4. Install gammu and gammu-smsd
```bash
apt install gammu gammu-smsd
```

### 5. Setup gammu-smsd
```bash
mkdir /var/log/smsd/
nano /etc/gammurc
```
The file sould contain this following lines (change the pin):
```ini
; Configuration file generated by gammu-detect.
; Please check The Gammu Manual for more information.

[gammu]
device = /dev/ttyUSB0
name = Phone on USB serial port HUAWEI_Technology HUAWEI_Mobile
connection = at

[gammu1]
device = /dev/ttyUSB1
name = Phone on USB serial port HUAWEI_Technology HUAWEI_Mobile
connection = at

[gammu2]
device = /dev/ttyUSB2
name = Phone on USB serial port HUAWEI_Technology HUAWEI_Mobile
connection = at

[smsd]
Service=files
PIN=XXXX
LogFile=/var/log/smsd/smsd.log
HangupCalls=1
RunOnReceive=/etc/sms_received.sh
InboxPath = /var/spool/gammu/inbox/
OutboxPath = /var/spool/gammu/outbox/
SentSMSPath = /var/spool/gammu/sent/
ErrorSMSPath = /var/spool/gammu/error/
```
### 6. create the shell scripts
```bash
sudo nano /etc/sms_received.sh
sudo chmod +x /etc/sms_received.sh
```
The file sould contain this following lines:
```bash
#!/bin/sh
bot_api_key="<your key vom botfather>"
chat_id="<your chat id>"
for i in `seq $SMS_MESSAGES` ; do
    number=SMS_${i}_NUMBER
    text=SMS_${i}_TEXT
    eval number_str=\$${number}
    eval text_str=\$${text}
    message="${number_str}:\n${text_str}"
    eval "curl -i -X GET https://api.telegram.org/bot${bot_api_key}/sendMessage -H \"Content-Type: application/json\" -X POST -d '{\"chat_id\":\"${chat_id}\",\"text\":\"${message}\"}'"
done
```
